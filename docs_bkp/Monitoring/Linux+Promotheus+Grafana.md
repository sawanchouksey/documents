# <img src="data:image/png;base64,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" title="" alt="Setup Prometheus and Grafana monitoring on Kubernetes cluster using Helm |  by Ankit Gangwar | Globant | Medium" width="794">

# Prometheus

### Installation

https://blog.devops.dev/how-to-install-and-configure-prometheus-on-linux-rhel-centos-amazonlinux-ec706c803fe8

### Overview

- It is an open-source system monitoring and alerting toolkit with an activ ecosystem
- It is tool that allows you to analyze how your application and infrastructure are performing from the metrics discover it
- It is written in GO
- Uses a 'multi-dimensional' data model with 'time series data' identified by 'metric name' and 'key/value pairs' 
  ex. http_requests_total{method="get"}
    |                    |       |
  metrics Name            key     value
- it uses a very simple language 'PromQL'
- PromQL is 'read-only' and a flexible query language that allows aggregation across any of the labels stored in its time series
- Default libraries and server available for prometheus - Windows, Linux , MySQL etc.
- To monitor custom services you can add instrumentation to your code , via Prometheus client libraries like GO, Java , scala, Python, Ruby and many more. 
- Full-fledged monitoring system with its own AlertManager

#### Check server UP time

```
up
```

### Exporter

- It is an s/w or number of libraries and server that help in exporting metrics from third party system(like linux or windows OS) in the same format as of prometheus metircs.

#### Node Exporter (Unix based system monitoring )

- It is a Prometheus exporter for h/w and OS metrics exposed by linux [*NIX] kernels.
- It exposes kernel-level and machine-level metrics in unix system like linux.
- When in action, It provides metrics such as CPU, memory, disk space , disk I/O and network bandwidth.
- It is written in GO with pluggable metric collectors.
- Download Node exporter "https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz"
- Extract the content of the file "node_exporter-1.5.0.linux-amd64.tar.gz" 
- cd node_exporter
- run the file to start it "./node_exporter"
- It will run on the url "address:9100/metrics"

#### add job for node_exporter in prometheus.yml

```
---
scrap_configs:
    - job_name: 'node_exporter'
      static_config: 
        - targets: ['localhost:9100']
---
```

- all metrics start with *node_* for node exporter i.e. memory related info "node_memory_*"

#### check available memory for machine installed node_exporter

```
node_memory_MemAvailable_bytes
```

### WMI Exporter (Monitoring Windows System)

- It stands for Windows Management Instrumentation (WMI) exporter.
- download and install "https://github.com/prometheus-community/windows_exporter/releases"
- double click on file and start application
- Url to access metrics "address:9182/metrics"
- all metrics start with *wmi_* for node exporter i.e. memory related info "wmi_cpu_*

#### add job for node_exporter in prometheus.yml

```
---
scrap_configs:
    - job_name: 'wmi_exporter'
      static_config: 
        - targets: ['localhost:9182']
---
```

#### check free disk space memory

```
wmi_logical_disk_free_bytes
```

### Data types in  PromQL

1. Instant vector : A set of time series containing a single sample for each time series all sharing the same timestamp.
   ex. prometheus_http_request_total

2. Range vector : A set of time series containing a range of data points over time for each time series.
   ex. prometheus_http_request_total[1m]

3. Scalar : A simple numeric floating point value.
   ex. 15.21

4. String : A simple string value , currently unused.
   ex. hello

### Selectors and matchers

- Equality matcher(=) : select labels that are exactly equals to the provided string
  ex. process_cpu_seconds_total{job='node_exporter' , instance='localhost:8080'} where job(selectors)='node_exporter'

- Negative Equality matcher(!=) : select labels that are not equals to the provided string
  ex. process_cpu_seconds_total{job='node_exporter' , instance!='localhost:8080'} where job(selectors)='node_exporter'

- Regular expression matcher(=~) : select labels that regex-match with the provided string
  ex. prometheus_http_request_total{handler=~"/api.*"}[1m] where 1m is one minute

- Negative Regular expression matcher(!~) : select labels that do not regex-match with the provided string
  ex. prometheus_http_request_total{handler!~"/api.*"}[1m] 1m is one minute.

### Operators

All operation performed on operands by operator in Query editor only.

1. Binary Operators
- Arithmatic BO 
  addition(+),substraction(-),multiplication(*),division(/),modulo(%), power/exponential(^)
  It is defined between scalar/scalar, vector/scalar and vector/vector value pairs.
  ex. node_memory_Active_bytes/8

- Comparison BO
  equal(==),not equal(!=), grater than(>), less than(<), greater or equal(>=), less or equal(<=)
  It is defined between scalar/scalar, vector/scalar and vector/vector value pairs.
  ex. process_open_fds > 12

- logical/set BO
  and(intersection), or(Union) , unless(complement)
  It is defined between instant vectors only.
  ex. vector1 and vector2 , vector1 or vector2 , vector1 unless vector2

- 'on' keyword
  used to check only specific label instead of all labels i.e. code labels.
  ex. promhttp_metric_handler_request_total and on(code) prometheus_http_request_total

- 'ignoring' keyword
  Used to ignore all matching labels and only match the left side element i.e. promhttp_metric_handler_request_total
  ex. promhttp_metric_handler_request_total and ignoring(handler) prometheus_http_request_total
2. Aggregation Operators
   It is special mathematical function that are used to combine information.
   sum,min,max,avg,stddev(calculate population standard deviation over dimension), stdvar(calculate population standard varienace over dimension),count,count_values,bottomk(smallest k element by sample value), topk(largest k element by sample value) quantile
- sum of request total
  ex. sum(prometheus_http_request_total)by(code)

- top 3 value from sum of top CPU 
  ex. topk(3, sum(node_cpu_seconds_total)by (mode))

- rate()
  It calculate the per-seconds average rate of increase of the time series in the range vector.
  Output the rate at which particular counter increasing.
  It is used to monitor slow moving counter in graphical interface.
  ex. rate(prometheus_http_request_total[1m])

- irate()
  It calculate the instant rate of increase of the time series in the range vector based on the last 2 data point gather.
  It is used to monitor fast moving volatile counter in graphical interface.
  ex. irate(prometheus_http_request_total[1m])

- *_over_time()
  Get the value of aggregate function over specific time range we used over_time function.

- avg_over_time()
  ex. avg_over_time(node_cpu_seconds_total[1h])

- count_over_time()
  ex. count_over_time(node_cpu_seconds_total[1h])

- max_over_time()
  ex. max_over_time(node_cpu_seconds_total[1h])

- min_over_time()
  ex. min_over_time(node_cpu_seconds_total[1h])

- sort(), sort_desc(), sort_asc()
  ex. sort(node_cpu_seconds_total)

- time(), days_of_week(), days_of_month()
  return current time in UTC in seconds.
  ex. time()-process_start_time_seconds{job="node_exporter"}

- predict_linear()
  function predicts the value of time series t seconds from now, based on the range vector v.

- kill process id in linux
  kill -HUP <PID>

### Alerting

- Prometheus allows you to define some conditions/logics in form of PromQL expressions that continuesly get evaluated and when those conditions are met they become alert.
  ex. Free node memory should not be less than 10%.
    CPU load not more than 95%.
- Alerting rule are written in Yaml file.
- Alert notification configured for email, pagerduty, slack.

#### Create and firing alerts by creating myrules.yml

```
---
groups:
  - name: my-rules
    rules:
       - record: job:node_cpu_seconds:avg_idle
         expr: avg without(cpu)(rate(node_cpu_seconds_total{mode="idle"}[5m]))

       - alert: NodeExporterDown
         expr: up{job="node_exporter"}==0
         for: 1m
         labels:
           severity: critical

---
- update prometheus.yml
rule_files:
  - "rules/myrules.yml"
---Â 
```

#### check the alerts state in Query editor

```
ALERTS
```

### AlertManager

- It is a tool that takes the firing alert from all prometheus server and convert them into notification. It takes care of deduplicating, grouping, and routing them to correct receiver integration such as emails , pagerduty, or OpsGenie.
- Download and install alertmanager "https://prometheus.io/download/#alertmanager"
- extract the content from the file.

#### configured the prometheus.yml

```
---
alerting:
    alertmanagers:
    - static_config:
      - targets:
        - localhost: 9093
---
```

- cd alertmanager
- run and start the alertmanager by "./alertmanager"
- Access the URL by "localhost:9093" for alertmanager.

#### configured the alertmanager.yml

```
---
route:
  receiver: admin

receivers:
- name: admin
  email_configs:
  - to: 'example@gmail.com'
    from: 'example@gmail.com'
    smarthost: smtp.gmail.com:587
    auth_username: 'example@gmail.com'
    auth_identity: 'example@gmail.com'
    auth_password: 'fqkvkumorgaqgkat'
---
```

- Routing configured for alert can be done in alertmanager.yml file
- check routing tree configuration online "https://prometheus.io/webtools/alerting/routing-tree-editor/"

### Slack configuration with prometheus

- create webhook in Slack for #Prometheus
- edit and update alertmanager.yml

```
---
- name: windows-team-manager
  slack_cofig:
  - channel: '#prometheus'
    api_url: 'https://hooks.slack.com/services/kljdflkjsdkfjskl/fjkhdsfkhdk/fljshgsdfg'
    title: 'WMI exporter is down'
    text: 'WMI exporter is down for 2 minutes'
---
```

### Blackbox exporter

- It is probabing exporter that allows you to monitor network endpoint such as http, https, DNS, ICMP or tcp
- On probing it returns a detailed metrics about the request.
  Use Case : 
- No knowledge of system internals.
- used to measure response time.
- to resolve DNS response time to diagnose network latency issues
- to check the availblity of your services their uptime network health and other things
- the url for "localhost:9115/metrics"
- check tcp connective active by url
  http://localhost:9115/probe?target=localhost:8000&module=tcp_connect
  if probe_success = 0 then tcp_probe failed
  if probe_success = 1 then tcp_probe passed

#### MySQL exporter

https://github.com/prometheus/mysqld_exporter/releases

- run and start the mysql exporter "./mysqld_exporter --config.my.cnf=./.my.cnf"
- run on "localhost:9104/metrics"

#### Writing custom exporter

naming convention "https://prometheus.io/docs/instrumenting/writing_exporters/"

- metric name should be start with letter and followed by any number of letters, numbers and underscore.
- mutric must have unique name  and client libraries would report an error if you try to register the same metric twice for your application.
- if applicable when exposing the time series for counter type metrics a '_total' suffix is added automatically in the exposed metrics.
- should represent the same logical thing-being-measured across all labeled dimensions.

#### running prometheus query with http api get output in JSON

http://localhost:9090/api/v1/query?query=up
http://localhost:9090/api/v1/target?state=dropped
http://localhost:9090/api/v1/rules?type=alert
http://localhost:9090/api/v1/status/runtimeinfo

# GRAFANA

### install and start grfana

https://sbcode.net/grafana/install-grafana/
http://localhost:3000/ | user: admin  Password: admin

### Reverse Proxy grafana with nginx

https://sbcode.net/grafana/nginx/

Check if Nginx is installed and intall it

```
nginx -v
sudo apt install nginx
Now check its version
nginx -v
```

Now check its status

```
sudo service nginx status
Visit http://[your ip address]
You should get the default Nginx web server index.html.
```

CD to the Nginx sites-enabled folder

```
cd /etc/nginx/sites-enabled
```

Create a new Nginx configuration for Grafana

```
sudo nano YOUR-DOMAIN-NAME.conf
```

changing YOUR-DOMAIN-NAME to your actual domain name you've set up. Mine was grafana.sbcode.net.

```
server {
    listen 80;
    listen [::]:80;
    server_name  YOUR-DOMAIN-NAME;

    location / {
        proxy_set_header Host $http_host;
        proxy_pass           http://localhost:3000/;
    }
}
```

Save and restart Nginx

```
sudo service nginx restart
sudo service nginx status
```

Test it by visiting again

http://YOUR-DOMAIN-NAME

Visiting your IP address directly will still show the default Nginx welcome page. If you don't want this to happen, then you can delete its configuration using the command below.

```
rm /etc/nginx/sites-enabled/default
```

Grafana 9 and Ubuntu 22.04 i.e. Proxy Set Header

- Grafana 8 and version 9, the nginx configuration requires the extra line setting the proxy header for the location node.

```
server {
    listen 80;
    listen [::]:80;
    server_name  YOUR-DOMAIN-NAME;

    location / {
        proxy_set_header Host $http_host;
        proxy_pass           http://localhost:3000/;
    }
}
```

#### add SSL

- Bind SSL to your Grafana Nginx Proxy Add SSL Bind SSL to your Grafana Nginx Proxy
- use LetsEncrypt by following the Certbot instructions "https://certbot.eff.org/"
- For Web Server software, I choose Nginx
- For Operating system, I choose Ubuntu 20.04 LTS
- I then SSH onto my new Grafana server,

#### Run query in Granafa

```
Grafana Home-->explorer-->Select Data Source-->Edit SQL
```

### To create a Prometheus data source in Grafana:

1. Click on the "cogwheel" in the sidebar to open the Configuration menu.
2. Click on "Data Sources".
3. Click on "Add data source".
4. Select "Prometheus" as the type.
5. Set the appropriate Prometheus server URL (for example,Â `http://localhost:9090/`)
6. Adjust other data source settings as desired (for example, choosing the right Access method).
7. Click "Save & Test" to save the new data source

![Data source configuration](https://prometheus.io/assets/grafana_configuring_datasource.png)

#### Follow the standard way of adding a new Grafana graph. Then:

1. Click the graph title, then click "Edit".
2. Under the "Metrics" tab, select your Prometheus data source (bottom right).
3. Enter any Prometheus expression into the "Query" field, while using the "Metric" field to lookup metrics via autocompletion.
4. To format the legend names of time series, use the "Legend format" input. For example, to show only theÂ `method`Â andÂ `status`Â labels of a returned query result, separated by a dash, you could use the legend format stringÂ `{{method}} - {{status}}`.
5. Tune other graph settings until you have a working graph.

![Prometheus graph creation](https://prometheus.io/assets/grafana_qps_graph.png)

### Importing pre-built dashboards from Grafana.com

Grafana.com maintainsÂ [a collection of shared dashboards](https://grafana.com/dashboards)Â which can be downloaded and used with standalone instances of Grafana. Use the Grafana.com "Filter" option to browse dashboards for the "Prometheus" data source only.

You must currently manually edit the downloaded JSON files and correct theÂ `datasource:`Â entries to reflect the Grafana data source name which you chose for your Prometheus server. Use the "Dashboards" â†’ "Home" â†’ "Import" option to import the edited dashboard file into your Grafana install.

#### Dashboard Variables

GrafanaHome-->Dashboard-->DashboardSetting-->variables-->[+]Variables : host | Defination : label_values(node_uname_info{job="node"},nodename) | selection option : Multi-value -->update

#### use variables in json dashboard

```
"expr": "node_uname_info{job=\"node\", nodename=~\"$host\"}",
```

### Create Email Alert Contact Point

Before starting, ensure that your version of Grafana is 8.3 or higher. We will be using the newer unified alerting user interface.

```
wget https://dl.grafana.com/oss/release/grafana_8.3.3_amd64.deb
sudo dpkg -i grafana_8.3.3_amd64.deb
```

you will need an SMTP server. Many corporations will provide an SMTP service for their staff. This same service can be used to send emails from Grafana.

You will need an email account in your email provider, admin@your-domain.tld perhaps may be good. You will also need an accessible SMTP server address, e.g., mail.example.com and a port, usually 25 or 465.

Next to configure Grafana SMTP settings

```
sudo nano /etc/grafana/grafana.ini
```

Find the SMTP specific settings, uncomment and edit. Below are some sample settings. Your actual settings will depend on the domain name of your SMTP service.

```
[smtp]
enabled = true
host = mail.your-smtp-providers-domain.tld:465
user = admin@your-domain.tld
password = """your-password-wrapped-in-triple-quotes"""
from_address = admin@your-domain.tld
from_name = Grafana
ehlo_identity = your-smtp-providers-domain.tld
```

#### Restart Grafana and check its status.

```
sudo service grafana-server restart
sudo service grafana-server status
```

### Users and Roles in Grafana Dashboards

GrafanaHome-->Server Admin-->Users-->New user--> [Name | Email | username| Password | Create user ]-->click on user-->Permission: Frafana Admin : No-->Organization: main org. | Editor , viewer, Admin [select 1 role] 

### Team and organization in Garfana Dashboards

GrafanaHome-->Server Admin-->org
GrafanaHome-->Settings-->Team

### Support Me

**If you find my content useful or enjoy what I do, you can support me by buying me a coffee. Your support helps keep this website running and encourages me to create more content.**

[![Buy Me a Coffee](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/sawanchokso)

**Your generosity is greatly appreciated!**

##### Thank you for your support!ðŸ’š
